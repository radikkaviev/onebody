<% content_for :subnav do %>
  <div style="float:right;">
    <%= link_to image_tag('link.png', :alt => t('relationships.family'), :class => 'icon') + ' ' + t('relationships.family'), family_relationships_path(@person.family) %>
  </div>
  <li><%= link_to image_tag('user.png', :alt => @person.name, :class => 'icon') + ' ' + h(@person.name), @person %></li>
<% end %>

<% content_for :sidebar do %>
  <%= form_tag :remote => true, :url => search_path %>
    <%= hidden_field_tag :select_person, true %>
    <p>
      <%= t('relationships.add_a_relationship') %><br/>
      <label for="name"><%= t('search.search_by_name') %></label> <%= text_field_tag 'name' %>
      <br/>
      <%= submit_tag t('relationships.add_relationship_button') %>
    </p>
  </form>
  
  <div id="add_member" style="display:none;">
    <%= form_tag person_relationships_path(@person) do %>
      <label for="name"><%= t('relationships.relationship_type') %></label>
      <%= select_tag :name, options_for_select(['']+t('relationships.names').invert.sort), :onchange => "if(this.value=='other') { Element.show('other_name'); $('other_name').focus() } else Element.hide('other_name');" %>
      <%= text_field_tag :other_name, nil, :style => 'display:none;' %><div class="autocomplete" id="other_name_auto_complete"></div>
      <script type="text/javascript">
        new Autocompleter.Local('other_name', 'other_name_auto_complete', <%= @other_names.inspect %>, {});
      </script>
      <div id="results"></div>
      <p><%= submit_tag t('search.add_selected') %></p>
    <% end %>
  </div>
<% end %>

<h1><%= @person.name %></h1>

<h2><%= t('relationships.outward') %></h2>

<% if @relationships.any? %>
  <%= form_tag batch_person_relationships_path(@person) do %>
    <table>
      <tr>
        <th><input type="checkbox" onclick="var check_all=this.checked; $$('.outward_relationship_checkbox').each(function(e){e.checked=check_all})"/></th>
        <th><%= t('name') %></th>
        <th><%= t('relationships.relationship') %>
      <th>
      <% @relationships.each do |relationship| %>
        <tr>
          <td><%= check_box_tag 'ids[]', relationship.id, false, :class => 'outward_relationship_checkbox' %></td>
          <td><%= link_to h(relationship.related.name), person_relationships_path(relationship.related) %></td>
          <td><%=h relationship.name_or_other %></td>
        </tr>
      <% end %>
    </table>
    <p>
      <%= submit_tag t('Delete'), :name => 'delete', :confirm => t('are_you_sure') %>
      <%= submit_tag t('relationships.Reciprocate'), :name => 'reciprocate' %>
    </p>
  <% end %>
<% else %>
  <p><em><%= t('none') %></em></p>
<% end %>

<h2><%= t('relationships.inward') %></h2>

<% if @inward_relationships.any? %>
  <%= form_tag batch_person_relationships_path(@person) do %>
    <table>
      <tr>
        <th><input type="checkbox" onclick="var check_all=this.checked; $$('.inward_relationship_checkbox').each(function(e){e.checked=check_all})"/></th>
        <th><%= t('From') %></th>
        <th></th>
        <th><%= t('To') %></th>
        <th><%= t('relationships.relationship') %>
      <th>
      <% @inward_relationships.each do |relationship| %>
        <tr>
          <td><%= check_box_tag 'ids[]', relationship.id, false, :class => 'inward_relationship_checkbox' %></td>
          <td><%= link_to h(relationship.person.name), person_relationships_path(relationship.person) %></td>
          <td><%= image_tag('arrow_right.png', :class => 'icon') %></td>
          <td><%=h @person.name %></td>
          <td><%=h relationship.name_or_other %></td>
        </tr>
      <% end %>
    </table>
    <p>
      <%= submit_tag t('Delete'), :name => 'delete', :confirm => t('are_you_sure') %>
      <%= submit_tag t('relationships.Reciprocate'), :name => 'reciprocate' %>
    </p>
  <% end %>
<% else %>
  <p><em><%= t('none') %></em></p>
<% end %>
