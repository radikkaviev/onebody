= form_for @person do |form|

  %ul.nav.nav-tabs
    %li.active
      = link_to t('people.edit.basics'), '#basics',    data: { toggle: 'tab' }
    %li
      = link_to t('people.edit.about'), '#about',      data: { toggle: 'tab' }
    %li
      = link_to t('people.edit.business'),   '#business',   data: { toggle: 'tab' }
    - if @logged_in.admin?(:edit_profiles)
      %li
        = link_to t('people.edit.person_type'), '#roles',     data: { toggle: 'tab' }
      %li
        = link_to t('people.edit.visibility'), '#visibility', data: { toggle: 'tab' }

  .tab-content
    .tab-pane.active#basics
      = render partial: 'form_basics', object: form, as: :form
      .form-group= form.submit t('save_changes'), class: 'btn btn-primary'
    .tab-pane#about
      = render partial: 'form_about', object: form, as: :form
      .form-group= form.submit t('save_changes'), class: 'btn btn-primary'
    .tab-pane#business
      = render partial: 'form_business', object: form, as: :form
      .form-group= form.submit t('save_changes'), class: 'btn btn-primary'
    - if @logged_in.admin?(:edit_profiles)
      .tab-pane#roles
        = render partial: 'form_roles', object: form, as: :form
        .form-group= form.submit t('save_changes'), class: 'btn btn-primary'
      .tab-pane#visibility
        = render partial: 'form_visibility', object: form, as: :form
        .form-group= form.submit t('save_changes'), class: 'btn btn-primary'

:javascript
  $('#person_birthday, #person_anniversary').datepicker({changeYear:true, yearRange:'1900:2025', dateFormat:'#{datepicker_format}'});

  $('#person_birthday').bind('keyup', function(){
    var val = $(this).val();
    if(val == '' || val.match(/1900/)) {
      $('#child-selection').show();
    } else {
      $('#child-selection select').val('');
      $('#child-selection').hide();
    }
  }).trigger('keyup');

  changes_made = false;
  $(':input').bind('change', function(){
    changes_made = true;
  });

  $('form').submit(function(){ changes_made = false });

  window.onbeforeunload = function() {
    if(changes_made) return '#{escape_javascript t('you_made_a_change_page')}';
  }
